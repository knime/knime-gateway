<html>
	<head>
		<title>some canvas</title>

		<script src="fabric.min.js"></script>
	</head>

	<body>
		<div id="bd-wrapper" ng-controller="CanvasControls">
			<canvas id="c" width="500" height="500" style="border:1px solid #ccc"></canvas>
			<script id="main">
					var canvas = this.__canvas = new fabric.Canvas('c', { selection: false });
					fabric.Object.prototype.originX = fabric.Object.prototype.originY = 'center';

					var nameCircleMap = {};

					function makeCircle(left, top, line1, line2, line3, line4, name, color) {
						var c = new fabric.Circle({
						  left: left,
						  top: top,
						  strokeWidth: 5,
						  radius: 12,
						  fill: color,
						  stroke: '#666'
						});
						c.hasControls = c.hasBorders = false;

						c.line1 = line1;
						c.line2 = line2;
						c.line3 = line3;
						c.line4 = line4;
						c.name = name;

						if (typeof notifyRCP === "function") {
							notifyRCP("creation", name, left, top, color);
						}

						nameCircleMap[name] = c;

						return c;
					}

					function moveCircle(name, left, top) {
						var circle = nameCircleMap[name];

						if (circle) {
							circle.set('left', left);
							circle.set('top', top);
							circle.setCoords();
							if (circle.line1) {
								circle.line1.setCoords();
							}
							if (circle.line2) {
								circle.line2.setCoords();
							}
							if (circle.line3) {
								circle.line3.setCoords();
							}
							if (circle.line4) {
								circle.line4.setCoords();
							}
							canvas.renderAll();
						}
					}

					function makeLine(coords) {
						return new fabric.Line(coords, {
						  fill: 'red',
						  stroke: 'red',
						  strokeWidth: 5,
						  selectable: false,
						  evented: false,
						});
					}

					var line = makeLine([ 250, 125, 250, 175 ]),
					  line2 = makeLine([ 250, 175, 250, 250 ]),
					  line3 = makeLine([ 250, 250, 300, 350]),
					  line4 = makeLine([ 250, 250, 200, 350]),
					  line5 = makeLine([ 250, 175, 175, 225 ]),
					  line6 = makeLine([ 250, 175, 325, 225 ]);

					canvas.add(line, line2, line3, line4, line5, line6);

					canvas.add(
						makeCircle(line.get('x1'), line.get('y1'), null, line, null, null, "head", "#D58989"),
						makeCircle(line.get('x2'), line.get('y2'), line, line2, line5, line6, "torso", "#A889D5"),
						makeCircle(line2.get('x2'), line2.get('y2'), line2, line3, line4, null, "pelvis", "#89D5B6"),
						makeCircle(line3.get('x2'), line3.get('y2'), line3, null, null, null, "right foot", "#63EE30"),
						makeCircle(line4.get('x2'), line4.get('y2'), line4, null, null, null, "left foot", "#80A174"),
						makeCircle(line5.get('x2'), line5.get('y2'), line5, null, null, null, "left hand", "#CBBF40"),
						makeCircle(line6.get('x2'), line6.get('y2'), line6, null, null, null, "right hand", "#FAA120")
					);

					canvas.on('object:moving', function(e) {
						var p = e.target;
						if (typeof notifyRCP === "function") {
							notifyRCP("move", p.name, p.left, p.top);
						}
						p.line1 && p.line1.set({ 'x2': p.left, 'y2': p.top });
						p.line2 && p.line2.set({ 'x1': p.left, 'y1': p.top });
						p.line3 && p.line3.set({ 'x1': p.left, 'y1': p.top });
						p.line4 && p.line4.set({ 'x1': p.left, 'y1': p.top });
						canvas.renderAll();
					});
			</script>
		</div>

		<script>
			(function() {
			  fabric.util.addListener(fabric.window, 'load', function() {
				var canvas = this.__canvas || this.canvas,
					canvases = this.__canvases || this.canvases;

				canvas && canvas.calcOffset && canvas.calcOffset();

				if (canvases && canvases.length) {
				  for (var i = 0, len = canvases.length; i < len; i++) {
					canvases[i].calcOffset();
				  }
				}
			  });
			})();
		</script>
	</body>
</html>
